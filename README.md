# spring-gift-JPA

## 기능 요구 사항
지금까지 작성한  JdbcTemplate 기반 코드를 JPA로 리팩터링하고 실제 도메인 모델을 어떻게 구성하고 객체와 테이블을 어떻게 매핑해야 하는지 알아본다.
- 아래의 DDL(data definition language)을 보고 유추하여 엔티티 클래스와 리포지토리 클래스를 작성해 본다.
- ```@DataJpaTest```를 사용하여 학습 테스트를 해본다.
```dtd
create table member
        (
        id       bigint generated by default as identity,
        email    varchar(255) not null unique,
        password varchar(255) not null,
        primary key (id)
        )
```
```dtd
create table product
(
    price     integer      not null,
    id        bigint generated by default as identity,
    name      varchar(15)  not null,
    image_url varchar(255) not null,
    primary key (id)
)
```
```dtd
create table wish
(
    id         bigint generated by default as identity,
    member_id  bigint not null,
    product_id bigint not null,
    primary key (id)
)
```

### 힌트
Spring Data JPA 사용 시 아래 옵션은 동작 쿼리를 로그로 확인할 수 있게 해준다.
```dtd
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.show-sql=true
```

```dtd
@DataJpaTest
class StationRepositoryTest {
    @Autowired
    private StationRepository stations;

    @Test
    void save() {
        Station expected = new Station("잠실역");
        Station actual = stations.save(expected);
        assertAll(
            () -> assertThat(actual.getId().).isNotNull(),
            () -> assertThat(actual.getName()).isEqualTo(expected.getName())
        );
    }
    
    @Test
    void findByName() {
        String expected ="잠실역"
        stations.save(new Station(expected));
        String actual = stations.findByName(expected).getName();
        assertThat(actual).isEqualTo(expected);
    }
}
```
H2 데이터베이스를 사용한다면 아래의 프로퍼티를 추가하면 MySQL Dialect을 사용할 수 있다.
```dtd
spring.datasource.url=jdbc:h2:mem:test;MODE=MYSQL;DB_CLOSE_DELAY=-1
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
```

```dtd
create table member
        (
        id       bigint       not null auto_increment,
        email    varchar(255) not null,
        password varchar(255) not null,
        primary key (id)
        ) engine=InnoDB

        create table product
        (
        price     integer      not null,
        id        bigint       not null auto_increment,
        name      varchar(15)  not null,
        image_url varchar(255) not null,
        primary key (id)
        ) engine=InnoDB

        create table wish
        (
        id         bigint not null auto_increment,
        member_id  bigint not null,
        product_id bigint not null,
        primary key (id)
        ) engine=InnoDB

        alter table member
        add constraint uk_member unique (email)
```




